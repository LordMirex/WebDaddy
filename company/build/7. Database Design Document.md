Database Design Document (Document 7)

Entity-Relationship Diagram: The database has tables for users, templates, domains, pending_orders, sales, affiliates, withdrawal_requests, and activity_logs. In the ER model, users (role=admin/affiliate) can create templates and manage domains. Each domain references a template (domains.template_id). When a user places an order, a row in pending_orders is created (with template_id and an optional chosen_domain_id). After payment, a sales row ties back to the pending order and the processing Admin. Affiliates have one-to-one relation with a user (affiliates.user_id) and connect to withdrawal requests. (A detailed PlantUML ER diagram is maintained in docs.)

Table Definitions: Major table structures include:

users: (id, name, email, phone, password_hash, role ENUM('admin','affiliate'), bank_details, created_at).

templates: (id, name, slug, price, category, description, demo_url, video_links JSON, active).

domains: (id, template_id, domain_name, status ENUM('available','in_use','suspended'), assigned_customer_id, notes, created_at).

pending_orders: (id, template_id, chosen_domain_id, customer_name, customer_email, customer_phone, custom_fields JSON, affiliate_code, session_id, message_text, status ENUM('pending','paid','cancelled'), created_at).

sales: (id, pending_order_id, admin_id, amount_paid, commission_amount, payment_method, payment_confirmed_at).

affiliates: (id, user_id, code, total_clicks, total_sales, commission_earned, commission_pending, commission_paid, status).

withdrawal_requests: (id, affiliate_id, amount, bank_details_json, status, requested_at, processed_at, processed_by).

activity_logs: (id, user_id, action, details JSON, ip, created_at).

Each table uses an auto-increment primary key (id). The template_id, pending_order_id, etc., are foreign keys enforcing referential integrity (e.g. FOREIGN KEY (template_id) REFERENCES templates(id)).

Indexes and Constraints: Key constraints include: the email in users is UNIQUE, as is the slug in templates and domain_name in domains to prevent duplicates. The affiliates table enforces a UNIQUE code for each affiliate. Foreign keys ensure domains link to valid templates and affiliate entries link to real users. Appropriate indexes are added on these foreign key columns to speed joins.

SQL DDL Scripts: The SQL CREATE TABLE statements (for use in phpMyAdmin or a migration tool) include all columns, data types, enums, and key constraints as above. For example, the core DDL includes:

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL UNIQUE,
  phone VARCHAR(30),
  password_hash VARCHAR(255) NOT NULL,
  role ENUM('admin','affiliate') NOT NULL,
  bank_details TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE templates (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255),
  slug VARCHAR(255) UNIQUE,
  price DECIMAL(10,2),
  category VARCHAR(100),
  demo_url VARCHAR(255),
  video_links TEXT,
  active TINYINT(1) DEFAULT 1
);
CREATE TABLE domains (
  id INT AUTO_INCREMENT PRIMARY KEY,
  template_id INT NOT NULL,
  domain_name VARCHAR(255) UNIQUE,
  status ENUM('available','in_use','suspended') DEFAULT 'available',
  assigned_customer_id INT NULL,
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE
);
-- (Additional tables for pending_orders, sales, affiliates, etc., follow similarly…)


These full DDL scripts are provided to set up the database schema exactly as specified.

Data Dictionary: Explanation of key fields:

users.role: Indicates if a user is an “admin” or “affiliate.”

templates.slug: URL-friendly identifier for each template (unique).

domains.status: “available” (free), “in_use” (assigned to a customer), or “suspended” (service on hold).

pending_orders.custom_fields (JSON): Stores any template-specific questions (e.g. “business type”) flexibly.

pending_orders.affiliate_code: Captures the affiliate code if the user arrived via an affiliate link (nullable otherwise).

sales.commission_amount: The commission paid to an affiliate for that sale (calculated as a percentage of price).

affiliates.code: The unique code string for each affiliate (used in tracking).

withdrawal_requests.status: Tracks payout request state (“pending,” “approved,” etc.).

Each column’s type and purpose are clearly documented so developers and DBAs know how data is stored and used.

Sample Data: For testing and initial setup, we include some example INSERTs. For instance:

INSERT INTO users (name,email,phone,password_hash,role) VALUES
('Admin User','admin@example.com','08012345678',SHA2('AdminPass',256),'admin'),
('John Affiliate','john@affiliate.com','08087654321',SHA2('JohnPass',256),'affiliate');
INSERT INTO affiliates (user_id,code) VALUES
(2,'JOHN30');  -- linking the above affiliate user
INSERT INTO templates (name,slug,price,category) VALUES
('E-commerce Site','ecommerce-store',200000,'Business'),
('Portfolio Site','portfolio-site',150000,'Personal');
INSERT INTO domains (template_id,domain_name,status) VALUES
(1,'mystore.ng','available'),
(1,'newshop.com','available'),
(2,'janesite.ng','available');
-- Pending order example:
INSERT INTO pending_orders (template_id,name,email,phone,session_id,message_text) VALUES
(1,'Jane Customer','jane@example.com','08011223344','sess123','Please confirm order.');


These sample rows enable immediate testing of UI and integration logic.